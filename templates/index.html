<!doctype html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Algebrator</title>

  </head>
  <body>
    <h1>Algebrator</h1>
    <br>
    <br>
    <span id="left-side" class="side">
    	<span class="variable">{{ a }}</span>x 
    	+ 
    	<span class="variable">{{ b }}</span>
    </span>
    	= 
    <span id="right-side" class="side">
    	<span class="variable">{{ c }}</span>
    </span>
    <br>
    <br>
    <span id="buttons">
		<button id="add" class="btn btn-lg btn-default" onclick="operation(this)">+</button>
		<button id="sub" class="btn btn-lg btn-default" onclick="operation(this)">-</button>
		<button id="mult" class="btn btn-lg btn-default" onclick="operation(this)">*</button>
		<button id="divide" class="btn btn-lg btn-default" onclick="operation(this)">/</button>
	</span>
	<br>
	<script>
		function operation(clicked){
			op = $(clicked).text()
			$('.variable').attr("onclick")
			if (op == '+' || op == '-'){
				console.log("add_sub(" + op + ", this)")
				$('.variable').attr('onclick', "add_sub('" + op + "', this)")
			} else {
				$('.variable').attr('onclick', "mult_div('" + op + "', this)")
			}
			highlight_vars()
			add_cancel_button(get_id_from_op(op))
		}

		function add_cancel_button(id){
			$('#buttons').append('<button id="cancel-button" class="btn btn-lg btn-danger" onclick="cancel(\'#'+id+'\')">Cancel</button>')
		}

		function highlight_vars(){
			$('.variable').attr("style", "background:cyan")
		}

		function cancel(elem){
			$('.variable').attr("onclick", "")
			$('.variable').attr("style", "background:white")
			$(elem).removeClass('btn-info')
			$(elem).addClass('btn-default')
			$('#cancel-button').remove()
		}

		function add_sub(op, clicked){
			v = $(clicked).text()

			// insert operator followed by the number
			$('.side').append(" " + op + " <span class='variable'>" + v + "</span> ")

			cancel(get_id_from_op(op))
		}

		function get_id_from_op(op){
			if (op == '+'){
				return "#add"
			}
			if (op == '-'){
				return "#sub"
			}
			if (op == '*'){
				return "#mult"
			}
			if (op == '/'){
				return "#divide"
			}
		}

		function mult_div(op, clicked){
			v = $(clicked).text()

			// surround both sides with parentheses
			$('.side').prepend('(').append(')')

			// insert operator followed by the number after the parentheses
			$('.side').append(" " + op + ' <span class="variable">' + v + '</span> ')

			cancel(get_id_from_op(op))

		}

	</script>
  </body>
</html>